<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>  Helping Travis catch the rustc train |  Huon on the internet</title>

  <link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Atom feed">
  <link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="RSS feed">
  
  <link rel="canonical" href="https://huonw.github.io/blog/2015/04/helping-travis-catch-the-rustc-train/">

  <meta name="viewport" content="width=device-width; initial-scale=1.0;" />
  

  
  <meta name="description" content="Manually configuring Travis CI to handle the Rust release trains and upload documentation is annoying. Getting a script to do it is far less annoying.
" />

  
  <meta name="twitter:card" content="summary" />
  
  <meta name="twitter:site" content="@huon_w" />
  <meta name="twitter:title" content="Helping Travis catch the rustc train" />
  <meta name="twitter:description" content="Manually configuring Travis CI to handle the Rust release trains and upload documentation is annoying. Getting a script to do it is far less annoying.
" />
  <meta name="twitter:url" content="https://huonw.github.io/blog/2015/04/helping-travis-catch-the-rustc-train/">

  <!-- facebook -->
  <meta property="og:url" content="https://huonw.github.io/blog/2015/04/helping-travis-catch-the-rustc-train/" />
  <meta property="og:title" content="Helping Travis catch the rustc train" />
  <meta property="og:description" content="Manually configuring Travis CI to handle the Rust release trains and upload documentation is annoying. Getting a script to do it is far less annoying.
" />
  
  <meta property="og:type" content="article" />
  
  
  
  <style>
    /*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */
*,::after,::before{box-sizing:border-box}html{line-height:1.15;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4}body{margin:0;font-family:system-ui, -apple-system,'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji'}hr{height:0;color:inherit}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}table{text-indent:0;border-color:inherit}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,select{text-transform:none}[type='button'],[type='reset'],[type='submit'],button{-webkit-appearance:button}::-moz-focus-inner{border-style:none;padding:0}:-moz-focusring{outline:1px dotted ButtonText}:-moz-ui-invalid{box-shadow:none}legend{padding:0}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type='search']{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}


    
      /* Borrowed from mojombo: https://github.com/mojombo/mojombo.github.com/blob/master/css/syntax.css */

.lineno { width: 2em; text-align:right; }
.highlight pre {
  white-space: pre;
}
.highlight .c { color: #777; font-style: italic; } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */


html {
    min-height:100%;
}

* {
  margin: 0;
}
* + * {
  margin-top: 0.75em;
}


body {
  padding:0px;
    counter-reset: footnotes;
    counter-reset: figure;
    margin:0px;
    font-size: 18px;
    background: white;
    color: #101010;

    font-variant: common-ligatures;
    -moz-font-feature-settings: "kern" on;
    -webkit-font-feature-settings: "kern" on;
    font-feature-settings: "kern" on;
}

#wrapper {
    margin: 0 auto;
    max-width: 630px;
    padding: 0.75em 15px;
    width: 100%;
    position:relative;
}

.lazily-filled {
  position: relative;
}
.lazily-filled > * {
  z-index: 0;
}
.lazily-filled::before {
  position: absolute;
  top: 0;
  left: 0;
  content: "";
  width: 100%;
  height: 100%;
  display: block;
  background-color: rgb(229, 236, 246);
  z-index: 1;
}
.lazily-filled::after {
  position: absolute;
  top: 50%;
  left: 50%;
  content: "";
  display: block;
  width: 128px;
  height: 128px;
  margin-left: -64px;
  margin-top: -64px;
  border-radius: 50%;
  border: 12px solid;
  border-color: white transparent;
  animation: spinner 5s linear;
  /* eventually stop animating when it's hidden */
  animation-iteration-count: 10;
  z-index: 2;
}
.lazily-filled::before, .lazily-filled::after {
  opacity: 0;
  transition: all 0.5s ease;
  pointer-events: none;
}
.lazily-filled:empty::before, .lazily-filled:empty::after {
  opacity: 1;
  animation-iteration-count: infinite;
  visibility: visible;
}
@keyframes spinner {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.plotly-plot * + * {
  margin-top: 0;
}

/* wonky safari */
.plotly text[style*="white-space: pre"] {
  white-space: nowrap !important;
}


/* lists */
li + li {
  margin-top: 0.5em;
}
ul, ol {
  padding-left: 1.5em;
}

table {
  margin-left: auto;
  margin-right: auto;
  border-collapse: collapse;
  text-align: left;
}

td, th {
  padding: 0.1em 0.75em;
}
@media (max-width: 500px) {
  td, th {
    padding-left: 0.375em;
    padding-right: 0.375em;
  }
}
tr:nth-child(even) {
  background: rgba(0, 0, 0, 5%);
}
thead {
  border-bottom: 1px solid grey;
  font-weight: bold;
}

header {
  margin-bottom: 1.5em;
}
header a:not(:hover) {
  text-decoration: none;
}
#blog-title {
  hyphens: none;
  font-variant: small-caps;
  font-size: 1.5em;
  font-weight: normal;
  text-align: center;
  line-height: 1em;
}
#info-list {
  list-style: none;
  padding: 0;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
}
#info-list li {
  margin: 0 1em;
}

#page-footer {
  border-top: 1px solid lightgrey;
  padding-top: 0.75em;
  color: grey;
  text-align: right;
}

.clear { clear: both; margin: 0; }


main {
    text-align:justify;
    -moz-hyphens: auto;
    -webkit-hyphens: auto;
    -ms-hyphens: auto;
    hyphens: auto;
    line-height: 1.5em;

    position: relative;
    z-index: 10;
}

a[href] {
    color: inherit;
    text-decoration: underline;
}

/*  The authorship info */
#info-intro {
    font-style: italic;
    text-align: center;
}

/* code */

code, pre {
  font-family: monospace;
  font-variant: none;
  -moz-hyphens: none;
  -webkit-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

pre {
  background: #f0f0f0;
}
code {
    background: #f7f7f7;
    padding: 0 0.1em;
    font-size: 0.9em;
    border-radius: 3px;
    border: 1px solid lightgrey;
}
pre code {
    background: none;
    padding: 0;
    -moz-hyphens: none;
    -webkit-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
    border-radius: 0;
    border-width: 0;
}
h1 code, h2 code, h3 code, h4 code {
  background: rgba(255,255,255,0.1);
}

.break-all {
  word-break: break-all;
}

/* quotes and similar */

blockquote {
    border: solid #eee;
    border-width: 0 1px;
    padding: 0 1.2em;
    color: #444;
    position: relative;
    margin-left: 0;
    margin-right: 0;
}

aside {
  padding: 0 1.2em;
  color: #444;
  position: relative;
}
aside[data-icon] {
  padding-left: 2.4em;
}
aside[data-icon]:before {
  content: attr(data-icon);
  position: absolute;
  left: 0;
  text-align: center;
  width: 2.4em;
}

/* images/figures */
img, figure svg {
  max-width: 100%;
  height: auto;
}
figure svg {
  width: 100%;
}
img:not(.inline-image), figure svg {
    display: block;
    margin: 0 auto;
    clear: both;
}

.image-positioner {
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}

img[data-caption]:before {
    content: attr(data-caption);
}
figure {
  clear: both;
}
figure.image {
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;

  min-width: 100%;
}
figcaption {
  margin: 0 auto;
  max-width: 570px;
  padding: 0 10px;
  text-align: center;
  font-style: italic;
  font-size: 0.9em;
}
figcaption p {
  display: inline;
}
figcaption::before {
  counter-increment: figure;
  content: "Figure " counter(figure) ". ";
}

.highlight table {
  font-size: 0.9em;
  padding: 0em;
  width: 100%;
  table-layout: fixed;
  overflow-y: hidden;
  display: block;
  position: relative;
  z-index: 1;
}
[data-lang] {
  position: relative;
  display: block;
}
[data-lang]::before {
  content: attr(data-lang);
  text-transform: capitalize;
  top: 0;
  right: 0;
  position: absolute;
  font-size: 1.5em;
  color: #f3f3f3;
  z-index: 1;
}

.highlight pre {
  background: transparent;
}
.gutter {
  padding: 0;
  border: solid #ccc;
  border-width: 0 1px 0 0;
  color: #ccc;
}
.lineno {
  width: 25px;
  padding-right: 5px;
}
.highlight td.code {
  overflow-x: auto;
  padding: 0;
  padding-left: 0.5em;
}


/* HEADINGS */

h1, h2 {
    font-variant: small-caps;
}

h1, h2, h3, h4 {
  -moz-hyphens: none;
  -webkit-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
  text-align: left;
}

h1 {
  font-size: 2.2em;
  text-align: center;
  line-height: 1em;
}
h2 {
  font-size: 1.7em;
}
h3 {
  font-size: 1.4em;
}
h4 {
  font-size: 1.2em;
}

/* crates.io badges */

.lib-info {
  float: right;
  width: 150px;
  text-align: center;
  margin: 0 1em;
}
.lib-badge {
  vertical-align: middle;
}
.centered-libs {
  text-align: center;
}
.centered-libs .lib-info {
  float: none;
}

/* external links */

#external-links {
  margin-top: 2.25em;
  text-align: center;
}
.external-label {
  font-weight: bold;
}
#external-links ul {
  list-style: none;
  display: inline-block;
  padding: 0;
  margin: 0;
}
#external-links li {
  list-style: none;
  display: inline;
}

/* "Footnotes" */

/* the div that holds them */
.footnotes {
    margin-top: 2.25em;
    padding-top: 1.5em;
    border-top: 1px solid rgb(240,240,240);
    font-size: 0.9em;
}
.footnotes ol {
  padding: 0;
}
.footnotes li {
    list-style-position: outside;
    margin-left: 30px;
    margin-right: 10px;
    color: #333;
}

.footnotes li:target, .footnotes li:hover {
    color: black;
    background-color: lightyellow;
}

.footnotes .reversefootnote {
    text-decoration: none;
}

/* extra info after a post */
#more {
  margin-top: 3em;
  padding-top: 1.5em;
  border-top: 1px solid lightgray;
}
#me-icon {
  max-width: 150px;
  height: 150px;
  background: url("/img/me.jpg");
  background-size: cover;
  margin-left: auto;
  margin-right: auto;
  border-radius: 30px;
}
#by-line {
  font-size: 0.8em;
}
#latest-list {
  padding: 0;
  list-style: none;
}
#latest-heading {
  text-align: center;
}
#latest-heading a:not(:hover) {
  text-decoration: none;
}
#latest-list a:hover h3 {
  text-decoration: underline;
}
#latest-list a {
  text-decoration: none;
}
.latest-post {
  padding: 0;
  font-size: 0.8em;
}
.latest-post > h3 {
  font-weight: bold;
}
.latest-post * {
  margin: 0;
}

/* post series */

.post-series {
  font-size: 0.8em;
  border: 1px solid lightgray;
  padding: 0.2em;
  cursor: pointer;
}

.post-series-title {
  font-weight: bold;
  font-size: 1.1em;
}
.post-series-list {
  padding-left: 1.5em;
  margin: 0;
}
.post-series .current {
  font-style: italic;
}

/* archive pages */
ul.post-list {
  list-style: none;
  padding: 0;
}

.post-post {
  margin: 0;
}

.post-post + .post-post {
  border-top: 1px dashed  #ddd;
  margin-top: 1em;
  padding-top: 1em;
}

a.post-heading {
  display: flex;
  align-items: baseline;
  text-decoration: none;
  gap: 1em;
}
.post-heading * {
  margin: 0;
}

.post-title {
  font-size: 1.2em;
  flex-grow: 1;
  text-decoration: underline;
}

.post-heading .post-date {
  font-style: italic;
  flex-shrink: 0;
}

.post-excerpt p {
  display: inline;
}

.post-more {
  font-style: italic;
  white-space: nowrap;
  float: right;
  margin: 0;
  font-size: smaller;
}

.post-list .footnote, .post-list .footnotes, .post-list p:empty {
  display: none
}

/* media queries */


@media only print {
    a {
      text-decoration: none !important;
    }
    header {
        display:none !important;
    }

    h1, h2, h3, h4 {
        padding-left: 0 !important;
    }

    #wrapper {
       max-width: none !important;
    }

    .no-print {
        display: none !important;
    }

    .footnotes .reversefootnote {
         display: none !important;
    }
    [data-lang]::before {
      content: "";
    }
}

    

    
  </style>
  
</head>

<body>
<div id="wrapper">
  <header>
    <h1 id="blog-title"><a href="/">Huon on the internet</a></h1>
    <nav>
      <ul id="info-list" class="no-print">
        <li><a href="/about">About</a></li>
        <li><a href="/blog">Blog</a></li>
        <li><a href="https://github.com/huonw">GitHub</a></li>
        <li><a href="https://bsky.app/profile/huonw.bsky.social">Bluesky</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <article>
      
        <h1 id="title"> Helping Travis catch the rustc train</h1>
        
      
      
         <div id="info-intro">
           By <a href="/about">Huon Wilson</a>
           
             &mdash; <span class="date pub-date">28 Apr 2015</span>
           
           
         </div>
      
      <p>I’ve been putting off configuring my continuous integration settings
to match the Rust train model: it involves non-trivial branching on
the configuration, and duplicating that over a pile of repos is not
something I looked forward to. So, instead, I wrote
<a href="https://github.com/huonw/travis-cargo">travis-cargo</a> to make things
easier.</p>

<h2 id="branching-on-configuration">Branching on configuration?</h2>

<p>One approach to developing Rust libraries once 1.0 is released will be
to test by building with the latest stable compiler, to ensure that
code is behaving as one hopes. I’m sure this will work well enough, but it’s missing an important part of the release model</p>

<p>Rust is adopting <a href="http://blog.rust-lang.org/2014/10/30/Stability.html">“trains”</a> for releases, where features migrate
from unstable to beta and then on to stable. That beta period is a big
motivation for the approach: before releases become stable, there is 6
weeks of development for people to test their code and help ensure
backwards compatibility isn’t accidentally broken. If there is a
regression, it will be assessed and presumably fixed before the stable
release. There is effort on going to incorporate this sort of checking
into <a href="https://crates.io/">crates.io</a>—brson has been posting regular
<a href="https://internals.rust-lang.org/t/regression-report-beta-2015-04-03-vs-nightly-2015-04-24/1967">regression reports</a> recently—but this doesn’t cover
all cases: at the very least, not all code is on crates.io.</p>

<p>The easiest way to get code to be tested is to have continuous
integration infrastructure like <a href="https://travis-ci.org/">Travis CI</a>
running tests against all configurations of interest: for a lot of
code this is likely to mean running builds against the most recent
stable release, the current beta, and the current nightly, and I
forsee that some libraries may wish to compile against slightly older
versions too. And having three builds for everything is just the start.</p>

<p>The nightly compilers offer unstable features that are fully
disallowed on the beta and stable channels, and libraries may wish to
offer or use functionality that is only enabled with unstable
compilers. At the moment, a big example is
<a href="http://doc.rust-lang.org/nightly/book/benchmark-tests.html">microbenchmarks with <code class="language-plaintext highlighter-rouge">#[bench]</code></a>, running them requires
importing the feature-gated <code class="language-plaintext highlighter-rouge">test</code> crate: I configure my libraries to
have an <code class="language-plaintext highlighter-rouge">unstable</code> <a href="http://doc.crates.io/manifest.html#the-[features]-section">feature</a> that has to be activated for
nightly-only features like benchmarks to be compiled in, so that the
library and its tests can be run with stable and beta compilers.</p>

<p>Unfortunately, all this means it is a little tricky to configure CI
optimally so that nightly builders build with unstable features, and
stable builds don’t. That said, It’s not <em>that</em> tricky, for example, using
<a href="http://docs.travis-ci.com/user/build-configuration/#The-Build-Matrix">Travis’ Build Matrix</a> functionality.</p>

<p>The final nail in the coffin is that I and others use CI to upload
rendered documentation for successful builds of the master branch:
<a href="http://www.hoverbear.org/2015/03/07/rust-travis-github-pages/">method I usually use</a> involves a big chunk of commands,
and requires manually inserting the library name. Having a separate
script allows me to use hoverbear’s code but abstracted out in a
DRY-er way. (The script even calls <code class="language-plaintext highlighter-rouge">cargo</code> directly to extract the
true library name, straight from the horse’s mouth.)</p>

<h2 id="travis-cargo-by-example">Travis-cargo by example</h2>

<blockquote>
  <p><em>Update 2015-05-01</em>: the details of the code here has now changed
but the explanation is still the same, see
<a href="/blog/2015/05/travis-on-the-train-part-2/"><em>Travis on the train, part 2</em></a> for the up-to-date version of
the code.</p>
</blockquote>

<div class="lib-info" style="">
  <a class="lib-link" href="http://huonw.github.io/order-stat/order_stat">order-stat</a>
  <a href="https://crates.io/crates/order-stat"><img class="lib-badge inline-image" src="https://img.shields.io/crates/v/order-stat.svg" alt="order-stat on crates.io" /></a>
</div>

<p>The interesting bit of the Travis configuration I’m now using for,
say,
<a href="https://github.com/huonw/order-stat/blob/eb6fd83/.travis.yml"><code class="language-plaintext highlighter-rouge">order-stat</code></a>,
looks like:</p>

<figure class="highlight"><pre><code class="language-yaml" data-lang="yaml"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="code"><pre><span class="na">language</span><span class="pi">:</span> <span class="s">rust</span>
<span class="c1"># run builds for both the nightly and beta branch</span>
<span class="na">rust</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">nightly</span>
  <span class="pi">-</span> <span class="s">beta</span>

<span class="c1"># load travis-cargo</span>
<span class="na">before_script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">git clone --depth 1 https://github.com/huonw/travis-cargo</span>
  <span class="c1"># make a short alias (`alias` itself doesn't work)</span>
  <span class="pi">-</span> <span class="s">ln -s ./travis-cargo/travis-cargo.py tc</span>

<span class="c1"># the main build</span>
<span class="na">script</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="pi">|</span>
      <span class="s">./tc cargo build &amp;&amp;</span>
      <span class="s">./tc cargo test &amp;&amp;</span>
      <span class="s">./tc cargo bench &amp;&amp;</span>
      <span class="s">./tc cargo doc</span>
<span class="na">after_success</span><span class="pi">:</span>
  <span class="c1"># upload the documentation from the build with beta (automatically only actually</span>
  <span class="c1"># runs on the master branch)</span>
  <span class="pi">-</span> <span class="s">./tc --only beta doc-upload</span>

<span class="c1"># ...</span>
</pre></td></tr></tbody></table></code></pre></figure>

<p>which makes builds look like (look at the two jobs!):</p>

<p><a href="travis.png"><img src="travis.png" alt="" /></a></p>

<p>And, it’s exactly the same configuration that I’m using for my other
libraries, other than the chunk of <code class="language-plaintext highlighter-rouge">secure</code> nonsense at the end (the
encrypted Github token).</p>

<p><code class="language-plaintext highlighter-rouge">tc cargo ...</code> just runs cargo, but implicitly adds <code class="language-plaintext highlighter-rouge">--feature
unstable</code> when running the <code class="language-plaintext highlighter-rouge">rust: nightly</code> configuration (and
<code class="language-plaintext highlighter-rouge">--verbose</code> by default for all configurations). The command <code class="language-plaintext highlighter-rouge">tc
doc-upload</code> pushes the docs rendered by <code class="language-plaintext highlighter-rouge">cargo doc</code> to the main repo,
but with multiple configuration this may result in “races”/displaying
documentation for an undesired or inconsistent configuration: the
<code class="language-plaintext highlighter-rouge">--only beta</code> argument ensures that it only runs in the <code class="language-plaintext highlighter-rouge">beta</code>
configuration.</p>

<p>On the point of uploading docs: I imagine/hope there will be some sort
of crates.io-based doc hosting in future which makes manually hosting
docs less imperative. However, that day isn’t here yet, and that host
will presumably only have docs for released crates, being able to
easily host documentation for the cutting-edge master branch still
seems handy.</p>

<p>Once we have a stable release, I intend to add <code class="language-plaintext highlighter-rouge">- stable</code> to <code class="language-plaintext highlighter-rouge">rust:</code>,
and switch <code class="language-plaintext highlighter-rouge">doc-upload</code> to <code class="language-plaintext highlighter-rouge">--only stable</code>; I believe these should be
the only changes necessary to get reliable testing against all three
channels.</p>

<p>Also, the manual passing of an unstable flag may become moot in
future, if the
<a href="https://internals.rust-lang.org/t/setting-cfg-nightly-on-nightly-by-default/1893">compiler itself supports a <code class="language-plaintext highlighter-rouge">nightly</code> <code class="language-plaintext highlighter-rouge">cfg</code> setting</a>,
further reducing the necessity for this script.</p>

<p>The <a href="https://github.com/huonw/travis-cargo">travis-cargo repo</a>
contains a README with more details, and the script itself.</p>

<p>(Thanks to hoverbear for their original code, and bluss for
<a href="https://users.rust-lang.org/t/psa-1-0-0-beta-2-is-out/1019/13">their similar shell script</a>
for inspiration.)</p>

<section id="external-links" class="no-print">
  
  <div id="comments">
    <span class="external-label">Comments:</span>
    <ul class="external-list">
      
<li class="external-link"><a href="https://users.rust-lang.org/t/helping-travis-catch-the-rustc-train/1167">users</a></li>


      
<li class="external-link"><a href="http://www.reddit.com/r/rust/comments/344o0e/helping_travis_catch_the_rustc_train/">/r/rust</a></li>


      

      

      

      
    </ul>
  </div>
  
  <div id="external-page">
    <span class="external-label">Share this on</span>
    <ul class="external-list">
      <li class="external-link"><a href="https://bsky.app/intent/compose?text=Helping%20Travis%20catch%20the%20rustc%20train%20by%20@huonw.bsky.social%20https://huonw.github.io/blog/2015/04/helping-travis-catch-the-rustc-train/" target="_blank" rel="nofollow noopener" title="Share on Bluesky">Bluesky</a></li>
      <li class="external-link"><a href="https://twitter.com/intent/tweet?text=Helping%20Travis%20catch%20the%20rustc%20train%20%23rustlang&amp;url=https://huonw.github.io/blog/2015/04/helping-travis-catch-the-rustc-train/&amp;via=huon_w" target="_blank" rel="nofollow noopener" title="Share on Twitter">Twitter</a></li>
      <li class="external-link"><a href="https://facebook.com/sharer.php?u=https://huonw.github.io/blog/2015/04/helping-travis-catch-the-rustc-train/" rel="nofollow noopener" target="_blank" title="Share on Facebook">Facebook</a></li>
      <li class="external-link"><a href="https://www.reddit.com/submit?url=https://huonw.github.io/blog/2015/04/helping-travis-catch-the-rustc-train/&amp;title=Helping%20Travis%20catch%20the%20rustc%20train" rel="nofollow noopener" target="_blank" title="Share on Reddit">Reddit</a></li>
    </ul>
  </div>
</section>


    </article>

    
    <footer id="more" class="no-print">
      <div id="by-line">
  <a href="/about"><div class="no-print" id="me-icon"></div></a>

<p>I'm <a href="https://bsky.app/profile/huonw.bsky.social"><strong>Huon Wilson</strong></a>, a
 mathematically and statistically inclined software engineer.
 I have been a long-term volunteer
 on <a href="http://rust-lang.org">Rust</a>'s core team, a
 compiler engineer on the <a href="https://swift.org/">Swift</a> team
 at Apple, and a senior software engineer at CSIRO's Data61, working on the <a href="https://github.com/stellargraph/stellargraph">StellarGraph
 graph machine learning library</a>.
</p>
</div>
      <h2 id="latest-heading"><a href="/blog">Latest posts</a></h2>
      
      <nav>
        <ul id="latest-list"><!--
           
           --><li class="latest-post">
                <a href="/blog/2025/03/ev-newtons/">
                   <h3>Newtons are a unit of mileage</h3>
                     <p>For an EV, Newtons (N) is a seemingly sensible version of L/100km or mpg, for measuring the efficiency of the car. Summing drag and rolling resistance forces aligns closely to real world observations.
</p>
                   
                 </a>
            </li><!--
          
           --><li class="latest-post">
                <a href="/blog/2025/02/ci-tee/">
                   <h3>Prefer tee -a, not >>, in CI</h3>
                     <p><table>
  <tbody>
    <tr>
      <td>GitHub Actions suggests using code like echo … » $GITHUB_ENV, but echo …</td>
      <td>tee -a $GITHUB_ENV is often better.</td>
    </tr>
  </tbody>
</table>
</p>
                   
                 </a>
            </li><!--
          
           --><li class="latest-post">
                <a href="/blog/2024/08/async-hazard-mmap/">
                   <h3>Async hazard: mmap is secretly blocking IO</h3>
                     <p>Memory-mapping a file is convenient, but it’s a hazard when used with async/await concurrent code: it means a “simple” memory index does blocking IO.
</p>
                   
                 </a>
            </li><!--
          
      --></ul>
      </nav>
    </footer>
    
  </main>

  <footer id="page-footer">
    <span>Huon Wilson &mdash; <span class="date">2021</span></span>
  </footer>
</div>



<!-- Default Statcounter code for huonw.github.io
http://huonw.github.io -->
<script type="text/javascript">
var sc_project=7439209;
var sc_invisible=1;
var sc_security="b96244c7";
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js"
async></script>
<noscript><div class="statcounter"><a title="hit counter"
href="https://statcounter.com/" target="_blank"><img
class="statcounter"
src="https://c.statcounter.com/7439209/0/b96244c7/1/"
alt="hit counter"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
<!-- End of Statcounter Code -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-62534856-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-62534856-1');
</script>



</body> </html>
